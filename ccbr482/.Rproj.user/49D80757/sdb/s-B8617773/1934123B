{
    "contents" : "\n#BRCA, COAD, LUAD, LUSC, READ, SKCM, THCA\ntype=\"THCA\"\n\np <- function(..., sep=',') {\n  paste(..., sep=\"\", collapse=sep)\n}\n\nlibrary(stringr)\ndir=p(\"/Users/maggiec/GitHub/Maggie/ccbr540/data/gdac.broadinstitute.org_\",type,\".Merge_Clinical.Level_1.2015060100.0.0\")\nsetwd(dir)\n\n#clin = read.csv(\"tp_clindata.txt\", na.strings = \"\",header=TRUE, sep=\"\\t\")\n#clin = read.csv(\"tp_BRCA_clinical.txt\", na.strings = \"\",header=TRUE, sep=\"\\t\")\nclin = read.csv(p(\"tp_\",type,\"_clinical.txt\"), na.strings = \"\",header=TRUE, sep=\"\\t\")\n\n# birth=clin$patient.days_to_birth\n# relative=clin$patient.first_degree_relative_history_thyroid_gland_carcinoma_diagnosis_relationship_types.first_degree_relative_history_thyroid_gland_carcinoma_diagnosis_relationship_type\n# patient=clin$patient.bcr_patient_barcode\n# survival=clin$patient.clinical_cqcf.days_to_death\n ethnicity=clin$patient.ethnicity\n# status=clin$patient.extrathyroid_carcinoma_present_extension_status\n# dead=clin$patient.vital_status\n# age=clin$patient.age_at_initial_pathologic_diagnosis\n# gender=clin$patient.gender\n# hist=clin$patient.histological_type\n# metastasis=clin$patient.malignant_neoplasm_metastatic_involvement_site\n# focal=clin$patient.clinical_cqcf.tumor_focality\n# state=clin$patient.follow_ups.follow_up.person_neoplasm_cancer_status\n# race=clin$patient.race\n# stage=clin$patient.stage_event.pathologic_stage\n\n#snpdat = read.table(\"/data/CCBR/projects/ccbr540/HABP2bams/HABP2_patient_snpstatus.txt\", header=FALSE, fill=TRUE, sep=\"\\t\")\nsnpdat = read.table(p(\"../\",type,\"_sample.txt\"), header=TRUE, fill=TRUE, sep=\"\\t\")\n#colnames(snpdat)=c(\"pat_id\",\"snp\")\n\n\nid=str_split_fixed(snpdat$pat_id, \"-\", 4)\nsnpdat$patid2=tolower(paste(id[,1],id[,2],id[,3],sep=\"-\"))\n# patdata=as.data.frame(cbind(as.character(patient),as.character(relative),\n#                             survival,\n#                             as.character(ethnicity),as.character(status),\n#                             as.character(dead),age,as.character(gender),\n#                             as.character(hist),as.character(metastasis),\n#                             as.character(focal),as.character(state),as.character(race),\n#                             as.character(stage)))\n# colnames(patdata)=c(\"pat\",\"relative\",\"survival\",\"ethnicity\",\"status\",\"dead\",\n#                     \"age\",\"gender\",\"hist\",\"metastasis\",\"focal\",\"state\",\"race\",\"stage\")\n# mergedat=merge(patdata,snpdat,by.x=\"pat\",by.y=\"patid2\")\n# \n# snpdat$snp[snpdat[]=\"432614\"\n# #snpid <- substr(mergedat2$snp, 1, 3)\n\nsnpdat$snpid=\"0/0\"\n\n#for (i in 2:7){\nfor (i in 7) {\nsnpgt=strsplit(as.character(snpdat[,i]), split=\":\")\nsnpdat$snp=sapply(snpgt,function(x) x[1])\nsnpdat$snpid[snpdat$snp==\"0/1\"]=\"0/1\"\nsnpdat$snpid[snpdat$snp==\"1/1\"]=\"0/1\"\n}\n\nsnpdat=snpdat[!duplicated(snpdat$patid2), ]\n\ndim(snpdat)\n[1] 1057   10  #BRCA\n[1] 299  10  #COAD\n[1] 573  10   #LUAD -need to redo\n[1] 484  10  #LUSC\n[1] 114  10  #READ\n[1] 470  10 #SKCM\n[1] 423  10  #THCA\n\n\ndim(snpdat[snpdat$snpid==\"0/1\",])\n[1] 87 10  # BRCA\n[1] 27 10 # COAD\n[1] 82 10  #LUAD\n[1] 46 10  #LUSC\n[1]  6 10  #READ\n[1] 53 10  #SKCM\n[1] 20 10  #THCA\n\ndim(snpdat[snpdat$snpid==\"0/0\",])\n[1] 1027   10  #BRCA\n[1] 284  10  #COAD\n[1] 597  10  #LUAD\n[1] 438  10  #LUSC\n[1] 108  10  #READ\n[1] 417  10  #SKCM\n[1] 403  10  #THCA\n\nmergedat2=merge(clin,snpdat,by.x=\"patient.bcr_patient_barcode\",by.y=\"patid2\")\n\ndim(clin)\n[1] 1085 3670  #BRCA\n[1]  453 3151  #COAD\n[1]  521 3011  #LUAD\n[1]  495 2694  #LUSC\n[1]  171 2742  #READ\n[1]  469 1877  #SKCM\n[1] 501 569  #THCA\n\ndim(mergedat2)\n[1] 1044 3679  #BRCA\n[1]  292 3160  #COAD\n[1]  513 3020  #LUAD\n[1]  476 2703 #LUSC\n[1]  114 2751  #READ\n[1]  469 1886 #SKCM\n[1] 364 578  #THCA\n\nlibrary(plyr)\ncount(mergedat2, \"patient.race\")\n\npatient.race freq\n1 american indian or alaska native    1\n2                            asian   44\n3        black or african american   13\n4                               NA   90\n5                            white  270\n\n\n#snpid <- substr(mergedat$snpid, 1, 3)\n#mergedat$SNP <- as.factor(ifelse(snpid == \"0/0\",0,1))\n#mergedat$age2 <- as.factor(ifelse(as.matrix(mergedat$age) <= 60,0,1))\n\nsnpid=mergedat2$snpid\nmergedat2$SNP <- as.factor(ifelse(snpid == \"0/0\",0,1))\n#mergedat$age2 <- as.factor(ifelse(as.matrix(mergedat$age) <= 60,0,1))\n\nmergedat2$age2 <- as.factor(ifelse(mergedat2$patient.age_at_initial_pathologic_diagnosis <= \n                              60,0,1))\n#mergedat2$gt <- as.factor(ifelse(mergedat2$patient.braf_gene_genotyping_outcome_lab_results_text==\"NA\", \n#                                     0,1))\n#mergedat2$gt2 <- as.factor(ifelse(mergedat2$patient.ras_family_gene_genotyping_outcome_lab_results_text==\"not identified\" | \n#                      mergedat2$patient.ras_family_gene_genotyping_outcome_lab_results_text==\"not identifed\",\n#                      0,ifelse(mergedat2$patient.ras_family_gene_genotyping_outcome_lab_results_text==\"NA\",\"NA\",1)))\n\n\n#mergedat2$gt <- as.factor(ifelse(mergedat2$patient.braf_gene_genotyping_outcome_lab_results_text==\"not identified\" |\n#                              mergedat2$patient.braf_gene_genotyping_outcome_lab_results_text==\"negative\", \n#                                 0,ifelse(mergedat2$patient.braf_gene_genotyping_outcome_lab_results_text==\"NA\",\"NA\",1)))\n\n#mergedat2$stage <- as.factor(ifelse(mergedat2$patient.stage_event.pathologic_stage==\"stage i\" |\n#                                   mergedat2$patient.stage_event.pathologic_stage==\"stage ii\", \n#                                 \"low\",ifelse(mergedat2$patient.stage_event.pathologic_stage==\"stage iii\" |\n#                                    mergedat2$patient.stage_event.pathologic_stage==\"stage iva\" |\n#                                      mergedat2$patient.stage_event.pathologic_stage==\"stage ivc\",\n#                                   \"high\",\"NA\")))\n\n#mergedat2$gt[mergedat2$patient.braf_gene_genotyping_outcome_lab_results_text==\"NA\"]=\"0\" \n\n# snprel=table(mergedat$relative,mergedat$SNP)\n# snpstage=table(mergedat$stage,mergedat$SNP)\n# metstage=table(mergedat$met,mergedat$SNP)\n# genstage=table(mergedat$gen,mergedat$SNP)\n# statstage=table(mergedat$status,mergedat$SNP)\n# racestage=table(mergedat$race,mergedat$SNP)\n# survstage=table(mergedat$surv,mergedat$SNP)\n# tab=table(mergedat2$gt,mergedat2$SNP)\n# \n# fisher.test(as.matrix(racestage))\n\n\nresult=vector()\n\nfor (i in 2:ncol(mergedat2)) {\n#for (i in 2:100) {\n  if (length(levels(mergedat2[,i])) <=10 & length(levels(mergedat2[,i])) > 1){\n  tab=table(mergedat2[,i],mergedat2$SNP)\n  tab\n  tabname=colnames(mergedat2)[i]\n  tabname\n  if (tab[1,1]==\"0\" & tab[1,2]==\"0\" | tab[2,1]==\"0\" & tab[2,2]==\"0\") {\n    fishtest$p.value=1}\n  else{fishtest=fisher.test(tab,simulate.p.value=TRUE)}\n  categ=paste(levels(mergedat2[,i]),\",\",collapse=\"\")\n  res=c(i,tabname,fishtest$p.value,categ)\n  result=rbind(result,res)\n}\n}\n\n#######For THCA: fishers exact test=0.000999500249875062 ##########\n> i=486\n> tab=table(mergedat2[,i],mergedat2$SNP)\n> tab\n\n0   1\nNA                  319  20\nnodular hyperplasia  14   7\nother, specify        4   0\n\nresult[result[,3]<=0.05,1:3]  \n#result_HABP=subset(mergedat2,grepl(\"0/1\", snp))\nresult_ALL=mergedat2\n\n#write.table(result,\"snp_assoc_clin_BRCA.txt\",row.names=FALSE,sep=\"\\t\")\n#write.table(result_HABP,\"snp_assoc_clin_HABP.txt\",row.names=FALSE,sep=\"\\t\")\n\nwrite.table(result,p(\"../../results/snp_assoc_clin_\",type,\".txt\"),\n                     row.names=FALSE,sep=\"\\t\")\nwrite.table(result_ALL,p(\"../../results/all_clin_\",type,\".txt\"),\n            row.names=FALSE,sep=\"\\t\")\n\n#############################END########\n\ntab=table(mergedat2[,i],mergedat2$SNP)\nfishtest=fisher.test(tab)\n\ndim(subset(mergedat2,grepl(\"0/1\", snp)))\nselected<-c(\"parent\",\"child\",\"sibling\")\ndim(mergedat2[mergedat2$relative %in% selected,])\nmergedat2[mergedat2$dead ==\"dead\",]\n\ngetwd()\n/gpfs/gsfs4/users/CCBR/projects/ccbr540/gdac.broadinstitute.org_THCA.Merge_Clinical.Level_1.2015040200.0.0\n\nsetwd(\"/Volumes/CCBR/projects/ccbr540/\")\nsetwd(\"gdac.broadinstitute.org_THCA.Merge_Clinical.Level_1.2015040200.0.0\")\nload(\".RData\")\n\nhead(patdata)\n",
    "created" : 1442443670875.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3275878909",
    "id" : "1934123B",
    "lastKnownWriteTime" : 1442452738,
    "path" : "~/GitHub/Maggie/ccbr540/Clin_HABP2.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}